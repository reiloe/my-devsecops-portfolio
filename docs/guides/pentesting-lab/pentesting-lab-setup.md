---
title: ðŸ” Pentesting Lab â€” Basic Setup for M1 Mac
---

# Pentesting Lab â€” Basic Setup for M1 Mac

---

## Table of Contents

1. [Objective of This Document](#objective-of-this-document)
2. [Overview / Components](#overview--components)
3. [Why M1 Mac?](#why-m1-mac)
4. [Virtualization Options (Pros / Cons)](#virtualization-options-pros--cons)
5. [Network Design (Best Practices)](#network-design-best-practices)
6. [VM List & Roles (Basic Setup)](#vm-list--roles-basic-setup)
7. [Installation & First Steps (Step-by-Step)](#installation--first-steps-step-by-step)
8. [Security Rules & Ethics](#security-rules--ethics)
9. [Example Configurations](#example-configurations)
10. [Persistence, Snapshots & Backup Strategy](#persistence-snapshots--backup-strategy)
11. [Extensions / Advanced Components](#extensions--advanced-components)
12. [Quick Checklist (Quickstart)](#quick-checklist-quickstart)
13. [Resources & Images (Where to Search)](#resources--images-where-to-search)

---

## Objective of This Document

This tutorial describes a secure, reproducible basic setup for a private pentesting lab on a **M1 Mac**. It is intended for learning purposes and must only be used in your own or explicitly authorized test environments.

---

## Overview / Components

- Host: Mac (Apple Silicon, M1)
- Virtualization: Parallels Desktop (Apple Silicon), UTM (QEMU), or Multipass / Docker (for containers)
- VMs/Images:
  - Kali Linux (ARM64) â€” attacker VM
  - Ubuntu Server (ARM64) â€” target service VM
  - Windows 11 (ARM) â€” target (optional, for Windows scenarios; Parallels supports Windows on ARM)
  - Metasploitable-like Linux VM (self-built) â€” insecure target machine
  - Domain Controller / Active Directory (Windows Server or Samba AD on Linux) â€” optional for AD tests
- Network segmentation: Host-only / internal network for isolated tests, optionally NAT for internet access
- Tools: Burp Suite, Wireshark, Nmap, Metasploit, Hashcat, John, Proxychains, Docker (for services)
- Snapshots & backups: Regular snapshots before changes; version configurations

---

## Why M1 Mac?

- Energy-efficient, good CPU performance for home lab
- Apple Silicon requires ARM images or emulation (UTM/QEMU)
- Easily portable, good I/O (USB, Thunderbolt) for external tools

---

## Virtualization Options (Pros / Cons)

### Parallels Desktop (Recommended for Convenience)

- Pro: Native Apple Silicon support; good performance for GUI VMs (e.g., Windows ARM).
- Con: Commercial, license costs.

### UTM (QEMU GUI)

- Pro: Free/OSS, very flexible, well-suited for ARM and emulation setups.
- Con: Somewhat more complex, performance of emulated x86 VMs is limited.

### Multipass / LXD / Docker (Containers)

- Pro: Fast, lightweight for service tests (web apps, DBs).
- Con: No full VM isolation; containers share kernel with host.

### Notes on VMware / VirtualBox

- Traditional x86 VM products have limited Apple Silicon support; therefore, prefer Parallels/UTM.

---

## Network Design (Best Practices)

- Create 3 networks on the host/hypervisor:
    1. **Host-Only / Internal** â€” isolated test network (attacker + targets). No direct connection to the internet.
    2. **NAT with internet access (optional)** â€” allows VMs updates/downloads via host NAT.
    3. **Management / Host-LAN** â€” host connects to the internet and dev tools; management only from host.
- Use different subnets, e.g.:
  - Management: 192.168.10.0/24
  - Lab (Internal): 10.10.0.0/24
  - NAT: 172.16.0.0/24
- Set firewall rules on the host so lab network has no unwanted outbound connections.
- Use VLANs if your network/router supports it.

---

## VM List & Roles (Basic Setup)

### 1) Kali Linux (Attacker)

- Image: Kali ARM64 (official Kali ARM images)
- RAM: 4â€“8 GB, CPU: 2â€“4 vCPU (depending on host)
- Tools: Metasploit, Nmap, Burp, Wireshark, Hydra, sqlmap, John, Hashcat (if GPU fits), proxychains
- Network: Host-Only (10.10.0.10)
- Persistence: Snapshots before major tests

### 2) Ubuntu Server (Web Target)

- Image: Ubuntu Server ARM64
- Services: Nginx/Apache, MySQL/MariaDB, a demo web application (e.g., DVWA or a minimally self-written app)
- Network: Host-Only (10.10.0.20)
- Configuration: enable SSH (for test access), but change secure passwords only after testing begins

### 3) Metasploitable-like / VulnBox (Practice Target)

- Build yourself a deliberately vulnerable VM (e.g., old PHP/MySQL versions) or use slightly modified labs
- Network: Host-Only (10.10.0.30)

### 4) Windows 11 (ARM) or Windows Server (optional)

- Use: AD tests, Windows exploits, lateral movement, GPO
- Parallels is helpful here; alternatively cloud VMs (Azure) if local ARM images are missing.
- Network: Host-Only / optional AD subnet

### 5) Logging / SIEM (optional)

- Elasticsearch + Kibana or Wazuh/OSSEC in a separate container/VM for log aggregation
- Network: Management / NAT (for updates) + logs accessible for the host

---

## Installation & First Steps (Step-by-Step)

### 1) Host Preparation (macOS)

```bash
# System update
sudo softwareupdate --install --all

# Install Homebrew (if not available)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Useful host tools
brew install --cask utm          # or install Parallels manually
brew install --cask docker       # Docker Desktop (Apple Silicon)
brew install git nmap wireshark
```

### 2) UTM / Parallels Setup

- Parallels: Install, create VM -> select Kali ARM or Windows ARM ISO.
- UTM: New VM -> Choose ARM64 Linux image -> allocate resources -> set drive/network.

### 3) Install Kali

- Download the official Kali ARM64 image (or Parallels image) and follow the installation routine.
- After installation: `sudo apt update && sudo apt upgrade` (in NAT network)

### 4) Create Target VMs

- Ubuntu Server: minimal install, set up required services (nginx, mysql).
- Metasploitable-like: deliberately install old packages (in isolated lab!)

### 5) Test Network

```bash
# Test ping from Kali to target
ping -c 3 10.10.0.20

# Nmap scan from Kali
nmap -sV -p- 10.10.0.20
```

---

## Security Rules & Ethics

- Always operate lab in **isolation**. Never use malicious tools against foreign systems.
- No open listeners with `-e` or backdoors from the lab exposed to the internet.
- Use strong passwords for host/Parallels/UTM, encrypt backups.
- Document activities and comply with legal/regulatory requirements.

---

## Example Configurations

### UTM Network Configuration (Example)

```text
# In UTM: Create a network interface as 'Shared Network' (NAT) or 'Emulated VLAN' for host-only.
# Assign static IPs in the VM (e.g., /etc/netplan for Ubuntu):
network:
version: 2
ethernets:
eth0:
dhcp4: no
addresses: [10.10.0.20/24]
gateway4: 10.10.0.1
nameservers:
addresses: [8.8.8.8,8.8.4.4]
```

### Example: Ubuntu Web Server â€“ Nginx + PHP (minimal)

```bash
sudo apt update && sudo apt install -y nginx php-fpm mariadb-server
sudo systemctl enable --now nginx
# Example webroot configuration
echo "<?php phpinfo(); ?>" | sudo tee /var/www/html/index.php
sudo chown -R www-data:www-data /var/www/html
```

### Example: Kali â€“ Basic Installation & Tools

```bash
sudo apt update && sudo apt install -y metasploit-framework nmap wireshark burpsuite
# Optional: install exploit-db, sqlmap, hydra, john
sudo apt install -y sqlmap hydra john
```

---

## Persistence, Snapshots & Backup Strategy

- Before each test: create VM snapshot.
- After critical changes: snapshot again.
- Regularly export VM images (UTM/Parallels has export/import).
- Store snapshots separately from host filesystem (external SSD) if possible.

---

## Extensions / Advanced Components

- **Active Directory Lab**: Windows Server (Domain Controller), Windows Client; test Kerberoasting, Pass-the-Hash, GPO attacks.
- **Cloud Hybrid**: Use an isolated cloud VM (e.g., Azure) for certain Windows ARM scenarios.
- **VPN / Proxy**: Set up a test VPN (OpenVPN/WireGuard) for complex scenarios.
- **Network Appliances**: pfSense VM as router/firewall in the lab (practical for routing/firewall tests).
- **Container-Based Targets**: Docker Compose stack with vulnerable web apps (OWASP Juice Shop, DVWA).

---

## Quick Checklist (Quickstart)

1. Update host, install Homebrew & UTM/Parallels.
2. Create host-only network and NAT network.
3. Create Kali VM (attacker).
4. Create Ubuntu/Web VM (target).
5. Create Metasploitable-like VM (practice target).
6. Optional: Windows ARM VM via Parallels.
7. Create snapshots and configure backups.
8. Test: Nmap, SSH, web access from Kali to targets.

---

## Resources & Images (Where to Search)

- Kali Linux (official downloads) â€” look for ARM64 / Parallels images.
- Ubuntu Server ARM64 â€” official Ubuntu downloads.
- OWASP Juice Shop (Docker) â€” for web app exercises.
- UTM / Parallels documentation for specific image import steps.

---
