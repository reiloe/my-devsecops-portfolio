---
title: üîê Pentesting Lab ‚Äî Basic Setup for Windows Host
---

# Pentesting Lab ‚Äî Basic Setup for Windows Host

---

## Table of Contents

1. [Objective of This Document](#objective-of-this-document)
2. [Overview / Components](#overview--components)
3. [Why Windows Host?](#why-windows-host)
4. [Virtualization Options (Pros / Cons)](#virtualization-options-pros--cons)
5. [Network Design (Best Practices)](#network-design-best-practices)
6. [VM List & Roles (Basic Setup)](#vm-list--roles-basic-setup)
7. [Installation & First Steps (Step-by-Step)](#installation--first-steps-step-by-step)
8. [Security Rules & Ethics](#security-rules--ethics)
9. [Example Configurations](#example-configurations)
10. [Persistence, Snapshots & Backup Strategy](#persistence-snapshots--backup-strategy)
11. [Extensions / Advanced Components](#extensions--advanced-components)
12. [Quick Checklist (Quickstart)](#quick-checklist-quickstart)
13. [Resources & Images (Where to Search)](#resources--images-where-to-search)

---

## Objective of This Document

This tutorial describes a secure, reproducible basic setup for a private pentesting lab on a **Windows host** (Windows 10/11 Pro or Enterprise). It is intended for learning purposes and must only be used in your own or explicitly authorized test environments.

---

## Overview / Components

- Host: Windows 10/11 Pro or Enterprise (Hyper-V required)
- Virtualization: Hyper-V, VirtualBox, or VMware Workstation
- VMs/Images:
  - Kali Linux (x86_64) ‚Äî attacker VM
  - Ubuntu Server (x86_64) ‚Äî target service VM
  - Windows 10/11 (x86_64) ‚Äî target (for Windows scenarios)
  - Metasploitable 2/3 ‚Äî pre-built vulnerable target machine
  - Domain Controller / Active Directory (Windows Server) ‚Äî optional for AD tests
- Network segmentation: Internal virtual switches for isolated tests, optionally External switch for internet access
- Tools: Burp Suite, Wireshark, Nmap, Metasploit, Hashcat, John, WSL2 (Kali Linux), Docker Desktop
- Snapshots & backups: Regular snapshots before changes; version configurations

---

## Why Windows Host?

- Native Hyper-V support on Windows Pro/Enterprise for excellent performance
- Familiar platform for many users; good for Windows-specific testing
- WSL2 support for running Linux tools directly on Windows
- Strong integration with Active Directory testing scenarios
- Good GPU passthrough support for password cracking (Hashcat)

---

## Virtualization Options (Pros / Cons)

### Hyper-V (Recommended for Windows Pro/Enterprise)

- Pro: Native Windows virtualization, excellent performance, free with Windows Pro/Enterprise
- Pro: Deep Windows integration, good for AD labs
- Con: Requires Windows Pro/Enterprise (not available on Home edition)
- Con: Cannot run alongside VirtualBox/VMware

### VirtualBox (Cross-Platform)

- Pro: Free, cross-platform, simple GUI
- Pro: Works on Windows Home edition
- Con: Cannot run alongside Hyper-V (must disable Hyper-V)
- Con: Slightly lower performance than Hyper-V

### VMware Workstation Pro

- Pro: Feature-rich, excellent performance, good snapshot management
- Pro: Can coexist with Hyper-V (with Windows 10 2004+)
- Con: Commercial license required

### Docker Desktop (Containers)

- Pro: Fast, lightweight for service tests (web apps, DBs)
- Con: No full VM isolation; containers share kernel
- Use case: Quick deployment of vulnerable applications (DVWA, Juice Shop)

### WSL2 with Kali Linux

- Pro: Native Linux environment on Windows, direct access to Windows files
- Pro: Very fast, low overhead, good for quick testing
- Con: Not full VM isolation, shares Windows kernel
- Use case: Running Kali tools directly on Windows host

---

## Network Design (Best Practices)

- Create 3 virtual switches in Hyper-V:
    1. **Internal Switch** ‚Äî isolated test network (attacker + targets). No direct connection to the internet.
    2. **External Switch with NAT (optional)** ‚Äî allows VMs updates/downloads via host NAT.
    3. **Default Switch** ‚Äî management connection to host network.
- Use different subnets, e.g.:
  - Management: 192.168.10.0/24
  - Lab (Internal): 10.10.0.0/24
  - NAT: 172.16.0.0/24
- Configure Windows Defender Firewall rules so lab network has no unwanted outbound connections.
- Use Hyper-V Internal switch for complete isolation.

---

## VM List & Roles (Basic Setup)

### 1) Kali Linux (Attacker)

- Image: Kali x86_64 (official Kali images or WSL2)
- RAM: 4‚Äì8 GB, CPU: 2‚Äì4 vCPU
- Tools: Metasploit, Nmap, Burp, Wireshark, Hydra, sqlmap, John, Hashcat
- Network: Internal Switch (10.10.0.10)
- Persistence: Snapshots before major tests

### 2) Ubuntu Server (Web Target)

- Image: Ubuntu Server 22.04/24.04 x86_64
- Services: Nginx/Apache, MySQL/MariaDB, a demo web application (e.g., DVWA)
- Network: Internal Switch (10.10.0.20)
- Configuration: enable SSH, configure deliberately weak settings for testing

### 3) Metasploitable 2/3 (Practice Target)

- Pre-built vulnerable VM available for download
- Network: Internal Switch (10.10.0.30)
- Services: Multiple vulnerable services (FTP, SSH, Samba, web apps)

### 4) Windows 10/11 Target (optional)

- Use: Windows exploits, lateral movement, AD testing
- Obtain evaluation ISO from Microsoft
- Network: Internal Switch / optional AD subnet

### 5) Windows Server (Domain Controller) (optional)

- Use: Active Directory testing, Kerberoasting, Golden Ticket attacks
- Network: Separate AD subnet or Internal Switch

### 6) Logging / SIEM (optional)

- Elasticsearch + Kibana or Wazuh in a separate container/VM for log aggregation
- Network: Management / NAT (for updates) + logs accessible for the host

---

## Installation & First Steps (Step-by-Step)

### 1) Host Preparation (Windows)

**Enable Hyper-V** (PowerShell as Administrator):

```powershell
# Check Windows edition (Pro/Enterprise required)
Get-WindowsEdition -Online

# Enable Hyper-V
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All

# Restart required
Restart-Computer
```

**Alternative: Install VirtualBox** (if not using Hyper-V):

```powershell
# Using winget (Windows Package Manager)
winget install Oracle.VirtualBox

# Or download from: https://www.virtualbox.org/wiki/Downloads
```

### 2) Install Useful Host Tools

**Using winget:**

```powershell
# Install Wireshark
winget install WiresharkFoundation.Wireshark

# Install Nmap
winget install Insecure.Nmap

# Install Git
winget install Git.Git

# Install VSCode (optional)
winget install Microsoft.VisualStudioCode
```

**Using Chocolatey:**

```powershell
# Install Chocolatey first
Set-ExecutionPolicy Bypass -Scope Process -Force
[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

# Install tools
choco install -y wireshark nmap git vscode
```

### 3) Install WSL2 with Kali Linux (Optional)

```powershell
# Enable WSL2
wsl --install

# Install Kali Linux from Microsoft Store
wsl --install -d kali-linux

# Or download Kali from: https://www.kali.org/get-kali/#kali-wsl
# Update Kali
wsl -d kali-linux
sudo apt update && sudo apt full-upgrade -y
```

### 4) Create Virtual Switches (Hyper-V)

**PowerShell (Administrator):**

```powershell
# Create Internal Switch for isolated lab network
New-VMSwitch -Name "Lab-Internal" -SwitchType Internal

# Get the network adapter index
Get-NetAdapter -Name "vEthernet (Lab-Internal)"

# Assign IP to host interface
New-NetIPAddress -IPAddress 10.10.0.1 -PrefixLength 24 -InterfaceAlias "vEthernet (Lab-Internal)"

# Optional: Create External Switch for internet access
New-VMSwitch -Name "Lab-External" -NetAdapterName "Ethernet" -AllowManagementOS $true
```

### 5) Configure Windows Defender Firewall

```powershell
# Allow inbound on lab network for testing (adjust as needed)
New-NetFirewallRule -DisplayName "Lab Internal Network" -Direction Inbound -InterfaceAlias "vEthernet (Lab-Internal)" -Action Allow

# Block lab network from reaching internet (optional)
New-NetFirewallRule -DisplayName "Block Lab Internet" -Direction Outbound -InterfaceAlias "vEthernet (Lab-Internal)" -Action Block -RemoteAddress Internet
```

### 6) Download and Install Kali Linux VM

**Using Hyper-V:**

```powershell
# Download Kali Hyper-V image (pre-built)
# https://www.kali.org/get-kali/#kali-virtual-machines

# Extract and import (example path)
cd C:\VMs
Expand-Archive kali-linux-2024.4-hyperv-amd64.7z

# Import VM
Import-VM -Path "C:\VMs\kali-linux-2024.4-hyperv-amd64\Virtual Machines\*.vmcx"

# Or create from ISO
New-VM -Name "Kali-Attacker" -MemoryStartupBytes 4GB -Generation 2 -NewVHDPath "C:\VMs\Kali.vhdx" -NewVHDSizeBytes 40GB
Set-VMProcessor -VMName "Kali-Attacker" -Count 2
Add-VMDvdDrive -VMName "Kali-Attacker" -Path "C:\ISOs\kali-linux-2024.4-installer-amd64.iso"
Connect-VMNetworkAdapter -VMName "Kali-Attacker" -SwitchName "Lab-Internal"
```

**Using VirtualBox:**

```powershell
# Download Kali VirtualBox image
# https://www.kali.org/get-kali/#kali-virtual-machines

# Import OVA
VBoxManage import kali-linux-2024.4-vbox-amd64.ova --vsys 0 --vmname "Kali-Attacker"

# Configure network
VBoxManage modifyvm "Kali-Attacker" --nic1 intnet --intnet1 "lab-network"
```

### 7) Create Target VMs

**Ubuntu Server Target (Hyper-V):**

```powershell
# Download Ubuntu Server ISO
# https://ubuntu.com/download/server

# Create VM
New-VM -Name "Ubuntu-Target" -MemoryStartupBytes 2GB -Generation 2 -NewVHDPath "C:\VMs\Ubuntu-Target.vhdx" -NewVHDSizeBytes 20GB
Set-VMProcessor -VMName "Ubuntu-Target" -Count 2
Add-VMDvdDrive -VMName "Ubuntu-Target" -Path "C:\ISOs\ubuntu-24.04-live-server-amd64.iso"
Connect-VMNetworkAdapter -VMName "Ubuntu-Target" -SwitchName "Lab-Internal"
Set-VMFirmware -VMName "Ubuntu-Target" -EnableSecureBoot Off
```

**Metasploitable 2 (Convert and Import):**

```powershell
# Download Metasploitable 2
# https://sourceforge.net/projects/metasploitable/

# Convert VMDK to VHDX (using qemu-img or StarWind V2V Converter)
# Download qemu-img for Windows: https://cloudbase.it/qemu-img-windows/

qemu-img.exe convert -O vhdx Metasploitable.vmdk metasploitable2.vhdx

# Create VM in Hyper-V
New-VM -Name "Metasploitable2" -MemoryStartupBytes 512MB -Generation 1 -VHDPath "C:\VMs\metasploitable2.vhdx"
Connect-VMNetworkAdapter -VMName "Metasploitable2" -SwitchName "Lab-Internal"
```

### 8) Configure Static IPs on VMs

**Configure Windows Host Interface:**

Already done in step 4 (10.10.0.1/24 on Lab-Internal)

**Kali Linux** (inside VM):

```bash
# Edit network configuration (assuming eth0)
sudo nano /etc/network/interfaces
```

```text
auto eth0
iface eth0 inet static
    address 10.10.0.10
    netmask 255.255.255.0
    gateway 10.10.0.1
    dns-nameservers 8.8.8.8 8.8.4.4
```

```bash
sudo systemctl restart networking
```

**Ubuntu Server** (netplan):

```bash
sudo nano /etc/netplan/01-netcfg.yaml
```

```yaml
network:
  version: 2
  ethernets:
    eth0:
      dhcp4: no
      addresses: [10.10.0.20/24]
      gateway4: 10.10.0.1
      nameservers:
        addresses: [8.8.8.8,8.8.4.4]
```

```bash
sudo netplan apply
```

### 9) Test Network Connectivity

```powershell
# From Windows host
ping 10.10.0.10  # Kali
ping 10.10.0.20  # Ubuntu

# From Kali VM
ping 10.10.0.20  # Ubuntu
nmap -sV 10.10.0.20
```

---

## Security Rules & Ethics

- Always operate lab in **isolation**. Never use malicious tools against foreign systems.
- No open listeners with backdoors from the lab exposed to the internet.
- Use strong passwords for host and VMs, encrypt backups with BitLocker.
- Configure Windows Defender Firewall to block unwanted traffic from lab network.
- Add lab folder to Windows Defender exclusions to prevent false positives.
- Document activities and comply with legal/regulatory requirements.

---

## Example Configurations

### Hyper-V Internal Network with NAT (Optional)

```powershell
# Create NAT network for internet access
New-NetNat -Name "LabNAT" -InternalIPInterfaceAddressPrefix 10.10.0.0/24
```

### Configure Hyper-V VM Enhanced Session (for better GUI)

```powershell
# Enable Enhanced Session Mode
Set-VMHost -EnableEnhancedSessionMode $true
```

### Ubuntu Target ‚Äî Install Vulnerable Web App (DVWA)

```bash
# Install LAMP stack
sudo apt update
sudo apt install -y apache2 mysql-server php libapache2-mod-php php-mysql php-gd git

# Download DVWA
cd /var/www/html
sudo git clone https://github.com/digininja/DVWA.git
sudo chown -R www-data:www-data DVWA
cd DVWA
sudo cp config/config.inc.php.dist config/config.inc.php

# Configure MySQL
sudo mysql -e "CREATE DATABASE dvwa;"
sudo mysql -e "CREATE USER 'dvwa'@'localhost' IDENTIFIED BY 'password';"
sudo mysql -e "GRANT ALL PRIVILEGES ON dvwa.* TO 'dvwa'@'localhost';"
sudo mysql -e "FLUSH PRIVILEGES;"

# Edit config file
sudo nano config/config.inc.php
# Set: $_DVWA[ 'db_password' ] = 'password';

# Restart Apache
sudo systemctl restart apache2
```

Access DVWA: `http://10.10.0.20/DVWA/setup.php`

### Windows Defender Exclusions for Lab Folder

```powershell
# Add exclusion for VM folder (prevents Defender from scanning VMs)
Add-MpPreference -ExclusionPath "C:\VMs"

# Add exclusion for tools folder
Add-MpPreference -ExclusionPath "C:\Tools"
```

### Kali on WSL2 ‚Äî Access Windows Network

```bash
# WSL2 can access Windows network interfaces
# Get Windows host IP from WSL2
ip route | grep default | awk '{print $3}'

# Scan Windows host network from WSL2
nmap -sn 192.168.1.0/24
```

---

## Persistence, Snapshots & Backup Strategy

### Hyper-V Snapshots

```powershell
# Create checkpoint (snapshot)
Checkpoint-VM -Name "Kali-Attacker" -SnapshotName "Before-Test"

# List checkpoints
Get-VMSnapshot -VMName "Kali-Attacker"

# Restore checkpoint
Restore-VMSnapshot -VMName "Kali-Attacker" -Name "Before-Test" -Confirm:$false

# Remove checkpoint
Remove-VMSnapshot -VMName "Kali-Attacker" -Name "Before-Test"
```

### VirtualBox Snapshots

```powershell
# Create snapshot
VBoxManage snapshot "Kali-Attacker" take "Before-Test" --description "Initial state"

# Restore snapshot
VBoxManage snapshot "Kali-Attacker" restore "Before-Test"

# List snapshots
VBoxManage snapshot "Kali-Attacker" list
```

### Backup Strategy

```powershell
# Export Hyper-V VM
Export-VM -Name "Kali-Attacker" -Path "D:\Backups\VMs"

# Compress with 7-Zip
# Download: https://www.7-zip.org/
7z a -t7z "D:\Backups\Kali-Attacker-backup.7z" "D:\Backups\VMs\Kali-Attacker"

# Use Windows Backup or robocopy for automated backups
robocopy "C:\VMs" "D:\Backups\VMs" /MIR /Z /LOG:backup.log
```

---

## Extensions / Advanced Components

- **Active Directory Lab**: Windows Server (Domain Controller), Windows Client; test Kerberoasting, Pass-the-Hash
- **Network Appliances**: pfSense VM as router/firewall in the lab
- **Container-Based Targets**: Docker Desktop with vulnerable apps (OWASP Juice Shop, DVWA)
- **IDS/IPS Testing**: Install Suricata or Snort in monitoring VM
- **VPN Lab**: Set up OpenVPN/WireGuard for complex network scenarios
- **Web Application Firewall**: ModSecurity with Apache for WAF testing
- **Hybrid Cloud**: Connect lab to Azure/AWS with VPN for cloud pentesting scenarios

---

## Quick Checklist (Quickstart)

1. Enable Hyper-V on Windows Pro/Enterprise (or install VirtualBox)
2. Install host tools: Wireshark, Nmap, Git (via winget/chocolatey)
3. Create Hyper-V Internal switch (Lab-Internal) and assign IP 10.10.0.1/24
4. Configure Windows Defender Firewall rules for lab isolation
5. Download Kali Linux and create attacker VM
6. Download Ubuntu Server and create target VM
7. Download and convert Metasploitable 2, import to Hyper-V
8. Configure static IPs on all VMs (10.10.0.10, 10.10.0.20, 10.10.0.30)
9. Create snapshots of all VMs before testing
10. Test connectivity: ping and nmap scans from Kali
11. Install vulnerable web app (DVWA) on Ubuntu target
12. Add VM folder to Windows Defender exclusions
13. Document network topology and VM credentials

---

## Resources & Images (Where to Search)

### Official Downloads

- **Kali Linux**: [https://www.kali.org/get-kali/](https://www.kali.org/get-kali/)
- **Ubuntu Server**: [https://ubuntu.com/download/server](https://ubuntu.com/download/server)
- **Metasploitable 2**: [https://sourceforge.net/projects/metasploitable/](https://sourceforge.net/projects/metasploitable/)
- **Metasploitable 3**: [https://github.com/rapid7/metasploitable3](https://github.com/rapid7/metasploitable3)
- **Windows Evaluation ISOs**: [https://www.microsoft.com/en-us/evalcenter/](https://www.microsoft.com/en-us/evalcenter/)
- **Windows Server Evaluation**: [https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server)

### Vulnerable Applications

- **DVWA**: [https://github.com/digininja/DVWA](https://github.com/digininja/DVWA)
- **OWASP Juice Shop**: [https://github.com/juice-shop/juice-shop](https://github.com/juice-shop/juice-shop)
- **WebGoat**: [https://github.com/WebGoat/WebGoat](https://github.com/WebGoat/WebGoat)
- **bWAPP**: [http://www.itsecgames.com/](http://www.itsecgames.com/)

### Tools & Utilities

- **qemu-img for Windows**: [https://cloudbase.it/qemu-img-windows/](https://cloudbase.it/qemu-img-windows/)
- **StarWind V2V Converter**: [https://www.starwindsoftware.com/starwind-v2v-converter](https://www.starwindsoftware.com/starwind-v2v-converter)
- **7-Zip**: [https://www.7-zip.org/](https://www.7-zip.org/)
- **Chocolatey**: [https://chocolatey.org/](https://chocolatey.org/)

### Documentation & Tutorials

- **Hyper-V Documentation**: [https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/](https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/)
- **VirtualBox Manual**: [https://www.virtualbox.org/manual/](https://www.virtualbox.org/manual/)
- **WSL Documentation**: [https://docs.microsoft.com/en-us/windows/wsl/](https://docs.microsoft.com/en-us/windows/wsl/)
- **Offensive Security Training**: [https://www.offensive-security.com/](https://www.offensive-security.com/)
- **HackTheBox**: [https://www.hackthebox.com/](https://www.hackthebox.com/)

---

**Important**: This lab is for **educational purposes only**. Never use these techniques against systems you don't own or have explicit written permission to test.
