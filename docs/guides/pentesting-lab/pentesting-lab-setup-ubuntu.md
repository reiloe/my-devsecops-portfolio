---
title: üîê Pentesting Lab ‚Äî Basic Setup for Ubuntu Host
---

# Pentesting Lab ‚Äî Basic Setup for Ubuntu Host

---

## Table of Contents

1. [Objective of This Document](#objective-of-this-document)
2. [Overview / Components](#overview--components)
3. [Why Ubuntu Host?](#why-ubuntu-host)
4. [Virtualization Options (Pros / Cons)](#virtualization-options-pros--cons)
5. [Network Design (Best Practices)](#network-design-best-practices)
6. [VM List & Roles (Basic Setup)](#vm-list--roles-basic-setup)
7. [Installation & First Steps (Step-by-Step)](#installation--first-steps-step-by-step)
8. [Security Rules & Ethics](#security-rules--ethics)
9. [Example Configurations](#example-configurations)
10. [Persistence, Snapshots & Backup Strategy](#persistence-snapshots--backup-strategy)
11. [Extensions / Advanced Components](#extensions--advanced-components)
12. [Quick Checklist (Quickstart)](#quick-checklist-quickstart)
13. [Resources & Images (Where to Search)](#resources--images-where-to-search)

---

## Objective of This Document

This tutorial describes a secure, reproducible basic setup for a private pentesting lab on an **Ubuntu Linux host**. It is intended for learning purposes and must only be used in your own or explicitly authorized test environments.

---

## Overview / Components

- Host: Ubuntu 22.04 LTS or 24.04 LTS (Desktop or Server)
- Virtualization: VirtualBox, KVM/QEMU (virt-manager), or Docker (for containers)
- VMs/Images:
  - Kali Linux (x86_64) ‚Äî attacker VM
  - Ubuntu Server (x86_64) ‚Äî target service VM
  - Windows 10/11 (x86_64) ‚Äî target (optional, for Windows scenarios)
  - Metasploitable 2/3 ‚Äî pre-built vulnerable target machine
  - Domain Controller / Active Directory (Windows Server) ‚Äî optional for AD tests
- Network segmentation: Host-only / internal network for isolated tests, optionally NAT for internet access
- Tools: Burp Suite, Wireshark, Nmap, Metasploit, Hashcat, John, Proxychains, Docker (for services)
- Snapshots & backups: Regular snapshots before changes; version configurations

---

## Why Ubuntu Host?

- Free, open-source, excellent hardware support
- Native KVM/QEMU support for near-native VM performance
- Large community, extensive documentation
- Flexible for both desktop and server environments
- Good resource management for multiple VMs

---

## Virtualization Options (Pros / Cons)

### KVM/QEMU with virt-manager (Recommended)

- Pro: Native Linux virtualization, excellent performance, free/OSS, full VM isolation
- Pro: Good for headless servers (libvirt management)
- Con: Slightly more complex initial setup than VirtualBox

### VirtualBox (Easy to Use)

- Pro: Simple GUI, cross-platform, easy snapshot management
- Pro: Good for beginners, familiar interface
- Con: Slightly lower performance than KVM

### Docker (Containers)

- Pro: Fast, lightweight for service tests (web apps, DBs)
- Con: No full VM isolation; containers share kernel with host
- Use case: Quick deployment of vulnerable applications (DVWA, Juice Shop)

### VMware Workstation Pro/Player

- Pro: Good performance, feature-rich
- Con: Commercial license (Pro), limited features in free Player

---

## Network Design (Best Practices)

- Create 3 networks on the host/hypervisor:
    1. **Host-Only / Internal** ‚Äî isolated test network (attacker + targets). No direct connection to the internet.
    2. **NAT with internet access (optional)** ‚Äî allows VMs updates/downloads via host NAT.
    3. **Management / Host-LAN** ‚Äî host connects to the internet and dev tools; management only from host.
- Use different subnets, e.g.:
  - Management: 192.168.10.0/24
  - Lab (Internal): 10.10.0.0/24
  - NAT: 172.16.0.0/24
- Set firewall rules on the host (ufw/iptables) so lab network has no unwanted outbound connections.
- Use bridge interfaces or libvirt networks for advanced setups.

---

## VM List & Roles (Basic Setup)

### 1) Kali Linux (Attacker)

- Image: Kali x86_64 (official Kali images)
- RAM: 4‚Äì8 GB, CPU: 2‚Äì4 vCPU
- Tools: Metasploit, Nmap, Burp, Wireshark, Hydra, sqlmap, John, Hashcat
- Network: Host-Only (10.10.0.10)
- Persistence: Snapshots before major tests

### 2) Ubuntu Server (Web Target)

- Image: Ubuntu Server 22.04/24.04 x86_64
- Services: Nginx/Apache, MySQL/MariaDB, a demo web application (e.g., DVWA)
- Network: Host-Only (10.10.0.20)
- Configuration: enable SSH, configure deliberately weak settings for testing

### 3) Metasploitable 2/3 (Practice Target)

- Pre-built vulnerable VM available for download
- Network: Host-Only (10.10.0.30)
- Services: Multiple vulnerable services (FTP, SSH, Samba, web apps)

### 4) Windows 10/11 (optional)

- Use: Windows exploits, lateral movement, AD testing
- Obtain evaluation ISO from Microsoft
- Network: Host-Only / optional AD subnet

### 5) Logging / SIEM (optional)

- Elasticsearch + Kibana or Wazuh in a separate container/VM for log aggregation
- Network: Management / NAT (for updates) + logs accessible for the host

---

## Installation & First Steps (Step-by-Step)

### 1) Host Preparation (Ubuntu)

```bash
# System update
sudo apt update && sudo apt upgrade -y

# Install KVM/QEMU and virt-manager
sudo apt install -y qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virt-manager

# Add user to libvirt groups
sudo usermod -aG libvirt $USER
sudo usermod -aG kvm $USER

# Reboot or re-login for group changes
# newgrp libvirt

# Verify KVM installation
sudo systemctl status libvirtd
kvm-ok  # Should show "KVM acceleration can be used"
```

### Alternative: Install VirtualBox

```bash
# Add Oracle VirtualBox repository
wget -O- https://www.virtualbox.org/download/oracle_vbox_2016.asc | sudo gpg --dearmor --yes --output /usr/share/keyrings/oracle-virtualbox-2016.gpg
echo "deb [arch=amd64 signed-by=/usr/share/keyrings/oracle-virtualbox-2016.gpg] https://download.virtualbox.org/virtualbox/debian $(lsb_release -cs) contrib" | sudo tee /etc/apt/sources.list.d/virtualbox.list

sudo apt update
sudo apt install -y virtualbox-7.0

# Add user to vboxusers group
sudo usermod -aG vboxusers $USER
```

### 2) Install Useful Host Tools

```bash
sudo apt install -y git nmap wireshark docker.io docker-compose

# Enable Docker service
sudo systemctl enable --now docker
sudo usermod -aG docker $USER
```

### 3) Configure Host Firewall

```bash
# Install and enable ufw
sudo apt install -y ufw

# Allow SSH for management
sudo ufw allow 22/tcp

# Default deny incoming, allow outgoing
sudo ufw default deny incoming
sudo ufw default allow outgoing

# Enable firewall
sudo ufw enable
```

### 4) Create Virtual Networks (KVM Example)

```bash
# Define isolated lab network (host-only)
cat <<EOF > lab-network.xml
<network>
  <name>lab-isolated</name>
  <bridge name='virbr10'/>
  <ip address='10.10.0.1' netmask='255.255.255.0'>
  </ip>
</network>
EOF

sudo virsh net-define lab-network.xml
sudo virsh net-start lab-isolated
sudo virsh net-autostart lab-isolated
```

### 5) Download and Install Kali Linux VM

```bash
# Download Kali VirtualBox/KVM image
wget https://cdimage.kali.org/kali-2024.4/kali-linux-2024.4-installer-amd64.iso

# Create VM with virt-manager (GUI) or virt-install (CLI)
virt-install \
  --name kali-attacker \
  --ram 4096 \
  --vcpus 2 \
  --disk path=/var/lib/libvirt/images/kali.qcow2,size=40 \
  --os-variant debian11 \
  --network network=lab-isolated \
  --graphics vnc \
  --cdrom /path/to/kali-linux-2024.4-installer-amd64.iso
```

### 6) Create Target VMs

**Ubuntu Server Target:**

```bash
# Download Ubuntu Server ISO
wget https://releases.ubuntu.com/24.04/ubuntu-24.04-live-server-amd64.iso

# Create VM
virt-install \
  --name ubuntu-target \
  --ram 2048 \
  --vcpus 2 \
  --disk path=/var/lib/libvirt/images/ubuntu-target.qcow2,size=20 \
  --os-variant ubuntu24.04 \
  --network network=lab-isolated \
  --graphics vnc \
  --cdrom /path/to/ubuntu-24.04-live-server-amd64.iso
```

**Metasploitable:**

```bash
# Download Metasploitable 2
wget https://sourceforge.net/projects/metasploitable/files/Metasploitable2/metasploitable-linux-2.0.0.zip

# Extract and import to KVM/VirtualBox
unzip metasploitable-linux-2.0.0.zip
qemu-img convert -O qcow2 Metasploitable.vmdk metasploitable2.qcow2
sudo mv metasploitable2.qcow2 /var/lib/libvirt/images/

# Create VM definition (adjust paths)
virt-install \
  --name metasploitable2 \
  --ram 512 \
  --vcpus 1 \
  --disk path=/var/lib/libvirt/images/metasploitable2.qcow2 \
  --import \
  --network network=lab-isolated \
  --graphics vnc \
  --os-variant debian7
```

### 7) Test Network Connectivity

```bash
# From Kali VM, test connectivity
ping -c 3 10.10.0.20  # Ubuntu target
ping -c 3 10.10.0.30  # Metasploitable

# Nmap scan
nmap -sV -p- 10.10.0.20
nmap -sV 10.10.0.30
```

---

## Security Rules & Ethics

- Always operate lab in **isolation**. Never use malicious tools against foreign systems.
- No open listeners with `-e` or backdoors from the lab exposed to the internet.
- Use strong passwords for host and VMs, encrypt backups.
- Configure ufw/iptables to block unwanted traffic from lab network.
- Document activities and comply with legal/regulatory requirements.

---

## Example Configurations

### KVM Network Configuration (Host-Only)

```bash
# Create isolated network without DHCP/NAT
cat <<EOF > /tmp/isolated-net.xml
<network>
  <name>lab-isolated</name>
  <bridge name='virbr-lab'/>
  <ip address='10.10.0.1' netmask='255.255.255.0'/>
</network>
EOF

sudo virsh net-define /tmp/isolated-net.xml
sudo virsh net-start lab-isolated
sudo virsh net-autostart lab-isolated
```

### Ubuntu Target ‚Äî Configure Static IP

```bash
# Edit netplan configuration
sudo nano /etc/netplan/01-netcfg.yaml
```

```yaml
network:
  version: 2
  ethernets:
    enp1s0:
      dhcp4: no
      addresses: [10.10.0.20/24]
      gateway4: 10.10.0.1
      nameservers:
        addresses: [8.8.8.8,8.8.4.4]
```

```bash
sudo netplan apply
```

### Ubuntu Target ‚Äî Install Vulnerable Web App (DVWA)

```bash
# Install LAMP stack
sudo apt update
sudo apt install -y apache2 mysql-server php libapache2-mod-php php-mysql php-gd git

# Download DVWA
cd /var/www/html
sudo git clone https://github.com/digininja/DVWA.git
sudo chown -R www-data:www-data DVWA
cd DVWA
sudo cp config/config.inc.php.dist config/config.inc.php

# Configure MySQL
sudo mysql -e "CREATE DATABASE dvwa;"
sudo mysql -e "CREATE USER 'dvwa'@'localhost' IDENTIFIED BY 'password';"
sudo mysql -e "GRANT ALL PRIVILEGES ON dvwa.* TO 'dvwa'@'localhost';"
sudo mysql -e "FLUSH PRIVILEGES;"

# Edit config file to match database credentials
sudo nano config/config.inc.php
# Set: $_DVWA[ 'db_password' ] = 'password';

# Restart Apache
sudo systemctl restart apache2
```

Access DVWA: `http://10.10.0.20/DVWA/setup.php`

### Kali ‚Äî Install Additional Tools

```bash
sudo apt update
sudo apt install -y metasploit-framework nmap wireshark burpsuite sqlmap hydra john hashcat exploitdb
```

---

## Persistence, Snapshots & Backup Strategy

### KVM Snapshots

```bash
# Create snapshot
sudo virsh snapshot-create-as kali-attacker snapshot1 "Before test"

# List snapshots
sudo virsh snapshot-list kali-attacker

# Restore snapshot
sudo virsh snapshot-revert kali-attacker snapshot1

# Delete snapshot
sudo virsh snapshot-delete kali-attacker snapshot1
```

### VirtualBox Snapshots

```bash
# Create snapshot (via GUI or CLI)
VBoxManage snapshot "kali-attacker" take "snapshot1" --description "Before test"

# Restore snapshot
VBoxManage snapshot "kali-attacker" restore "snapshot1"
```

### Backup Strategy

```bash
# Export VM disk images
sudo cp /var/lib/libvirt/images/kali.qcow2 /backup/kali-backup-$(date +%Y%m%d).qcow2

# Compress for storage
sudo qemu-img convert -O qcow2 -c /var/lib/libvirt/images/kali.qcow2 /backup/kali-compressed.qcow2
```

---

## Extensions / Advanced Components

- **Active Directory Lab**: Windows Server (Domain Controller), Windows Client; test Kerberoasting, Pass-the-Hash
- **Network Appliances**: pfSense VM as router/firewall in the lab
- **Container-Based Targets**: Docker Compose stack with vulnerable apps (OWASP Juice Shop, DVWA)
- **IDS/IPS Testing**: Install Suricata or Snort in monitoring VM
- **VPN Lab**: Set up OpenVPN/WireGuard for complex network scenarios
- **Web Application Firewall**: ModSecurity with Apache for WAF testing

---

## Quick Checklist (Quickstart)

1. Update Ubuntu host, install KVM/QEMU or VirtualBox
2. Configure ufw firewall, create isolated virtual networks
3. Download Kali Linux ISO and create attacker VM
4. Download Ubuntu Server ISO and create target VM
5. Download and import Metasploitable 2
6. Configure static IPs on all VMs in lab network (10.10.0.0/24)
7. Create initial snapshots of all VMs
8. Test connectivity: ping, nmap scans from Kali to targets
9. Install vulnerable web application (DVWA) on Ubuntu target
10. Document network topology and VM credentials

---

## Resources & Images (Where to Search)

### Official Downloads

- **Kali Linux**: [https://www.kali.org/get-kali/](https://www.kali.org/get-kali/)
- **Ubuntu Server**: [https://ubuntu.com/download/server](https://ubuntu.com/download/server)
- **Metasploitable 2**: [https://sourceforge.net/projects/metasploitable/](https://sourceforge.net/projects/metasploitable/)
- **Metasploitable 3**: [https://github.com/rapid7/metasploitable3](https://github.com/rapid7/metasploitable3)
- **Windows Evaluation ISOs**: [https://www.microsoft.com/en-us/evalcenter/](https://www.microsoft.com/en-us/evalcenter/)

### Vulnerable Applications

- **DVWA**: [https://github.com/digininja/DVWA](https://github.com/digininja/DVWA)
- **OWASP Juice Shop**: [https://github.com/juice-shop/juice-shop](https://github.com/juice-shop/juice-shop)
- **WebGoat**: [https://github.com/WebGoat/WebGoat](https://github.com/WebGoat/WebGoat)
- **bWAPP**: [http://www.itsecgames.com/](http://www.itsecgames.com/)

### Documentation & Tutorials

- **KVM/QEMU Guide**: [https://help.ubuntu.com/community/KVM](https://help.ubuntu.com/community/KVM)
- **VirtualBox Manual**: [https://www.virtualbox.org/manual/](https://www.virtualbox.org/manual/)
- **Offensive Security Training**: [https://www.offensive-security.com/](https://www.offensive-security.com/)
- **HackTheBox**: [https://www.hackthebox.com/](https://www.hackthebox.com/)

---

**Important**: This lab is for **educational purposes only**. Never use these techniques against systems you don't own or have explicit written permission to test.
